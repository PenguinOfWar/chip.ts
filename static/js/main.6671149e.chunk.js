(this["webpackJsonpchip.ts"]=this["webpackJsonpchip.ts"]||[]).push([[0],{57:function(t,e,s){},59:function(t,e,s){},60:function(t,e,s){"use strict";s.r(e);var i=s(0),r=s.n(i),n=s(24),o=s.n(n),c=s(30),h=s(13),a=s.n(h),l=s(25),u=s(15),g=s(10),f=s(28),k=s.n(f),d=s(29),b=s(6),p=s(7),m=[240,144,144,144,240,32,96,32,32,112,240,16,240,128,240,240,16,240,16,240,144,144,240,16,16,240,128,240,16,240,240,128,240,144,240,240,16,32,64,64,240,144,240,144,240,240,144,240,16,240,240,144,240,144,144,224,144,224,144,224,240,128,128,128,240,224,144,144,144,224,240,128,240,128,240,240,128,240,128,128],y=function(){function t(e,s){Object(b.a)(this,t),this.memory=new Uint8Array(new ArrayBuffer(4096)),this.registers=new Uint8Array(16),this.stack=new Uint16Array(16),this.stackPointer=0,this.counter=512,this.gfx=void 0,this.pointer=0,this.screen=new Uint8Array,this.delayTimer=0,this.soundTimer=0,this.keys={},this.key=0,this.running=!1,this.gfx=s,this.screen=new Uint8Array(this.gfx.resolution.x*this.gfx.resolution.y),this.load(e)}return Object(p.a)(t,[{key:"load",value:function(t){var e=this;this.loadFont(),t.map((function(t,s){var i=s+512;return e.memory[i]=t,t})),this.start()}},{key:"loadFont",value:function(){var t=this;return m.map((function(e,s){return t.memory[s]=e}))}},{key:"start",value:function(){this.running=!0}},{key:"stop",value:function(){this.running=!1}},{key:"next",value:function(){this.running&&this.tick()}},{key:"tick",value:function(){this.delayTimer>0&&--this.delayTimer,this.soundTimer>0&&--this.soundTimer;var t=this.memory[this.counter]<<8|this.memory[this.counter+1],e=(3840&t)>>8,s=(240&t)>>4,i=255&t,r=4095&t,n=!1;switch(61440&t){case 0:switch(t){case 224:console.log(this.counter,"Render clear");break;case 238:0===this.stack[this.stackPointer]&&console.warn("Invalid return from subroutine."),this.counter=this.stack[this.stackPointer],this.stack[this.stackPointer]=0,this.stackPointer>0&&--this.stackPointer,console.log(this.counter,"Return from subroutine",this.counter,this.stack,this.stackPointer)}break;case 4096:this.counter=r,n=!0;break;case 8192:0!==this.stack[this.stackPointer]&&++this.stackPointer,this.stack[this.stackPointer]=this.counter,this.counter=r,n=!0,console.log(this.counter,"calling subroutine",r,this.counter,this.stackPointer,this.stack);break;case 12288:console.log(this.counter,"Skip instruction check if VX === NN"),this.registers[e]===i&&(console.log("Skipped"),this.counter+=2);break;case 16384:console.log(this.counter,"Skip instruction check if VX !== NN"),this.registers[e]!==i&&(console.log("Skipped"),this.counter+=2);break;case 20480:console.log(this.counter,"Skip instruction check if VX === VY"),this.registers[e]===this.registers[s]&&(console.log("Skipped"),this.counter+=2);break;case 24576:console.log(this.counter,"Setting VX to NN",e,255&t),this.registers[e]=255&t;break;case 28672:console.log(this.counter,"Adding NN to VX",e,this.registers[e],i),this.registers[e]+=i;break;case 32768:switch(15&t){case 0:console.log(this.counter,"Setting VX to VY"),this.registers[e]=this.registers[s];break;case 1:console.log(this.counter,"Setting VX to VX or VY"),this.registers[e]=this.registers[e]|this.registers[s];break;case 2:console.log(this.counter,"Setting VX to VX and VY"),this.registers[e]=this.registers[e]&this.registers[s];break;case 3:console.log(this.counter,"Setting VX to VX xor VY"),this.registers[e]=this.registers[e]^this.registers[s];break;case 4:console.log(this.counter,"Adding VY to VX"),this.registers[e]+this.registers[s]>255?this.registers[15]=1:this.registers[15]=0,this.registers[e]+=this.registers[s];break;case 5:console.log(this.counter,"Subtracting VY from VX"),this.registers[e]<this.registers[s]?this.registers[15]=0:this.registers[15]=1,this.registers[e]-=this.registers[s];break;case 6:console.log(this.counter,"Storing least significant bit of VX in VF and right shift"),this.registers[e]%2===0?this.registers[15]=0:this.registers[15]=1,this.registers[e]=this.registers[e]>>1;break;case 7:console.log(this.counter,"Setting VX to VY minus VX"),this.registers[s]<this.registers[e]?this.registers[15]=0:this.registers[15]=1,this.registers[e]=this.registers[s]-this.registers[e];break;case 14:console.log(this.counter,"Storing most significant bit of VX in VF and left shift"),this.registers[e]<128?this.registers[15]=0:this.registers[15]=1,this.registers[e]=this.registers[e]<<1;break;default:throw new Error("Unknown opcode in 8000 block: ".concat(t.toString(16)))}break;case 40960:console.log(this.counter,"Setting I Pointer",this.pointer,r),this.pointer=r;break;case 45056:console.log(this.counter,"Jumping to",(4095&t)+this.registers[0]),this.counter=(4095&t)+this.registers[0],n=!0;break;case 49152:console.log(this.counter,"Setting VX to random number"),this.registers[e]=Math.floor(255*Math.random())%255&i;break;case 53248:var o,c=15&t,h={x:this.registers[e],y:this.registers[s]};this.screen[this.counter]=1,this.registers[15]=0,console.log(this.counter,"Drawing",h,c);for(var a=0;a<c;a++){o=this.memory[this.pointer+a],console.log(o,this.pointer,a);for(var l=0;l<this.gfx.resolution.scale;l++)h.x+l===this.gfx.resolution.x&&(h.x=-l),h.y+a===this.gfx.resolution.y&&(h.y=-a),(128&o)>0&&this.setPixel(this.registers[e]+l,this.registers[s]+a)&&(this.registers[15]=1),o<<=1;h.x=this.registers[e],h.y=this.registers[s]}break;case 57344:switch(i){case 158:console.log(this.counter,"Checking if a key is pressed"),this.key===this.registers[e]&&(console.log("Key press, skipping"),this.counter+=2);break;case 161:console.log(this.counter,"Checking if no key is pressed"),this.key!==this.registers[e]&&(console.log("No key press, skipping"),this.counter+=2);break;default:throw new Error("Unknown opcode in e000 block: ".concat(t.toString(16)))}break;case 61440:switch(i){case 7:console.log(this.counter,"Setting VX to delay value",e,this.delayTimer),this.registers[e]=this.delayTimer;break;case 10:console.log(this.counter,"waiting for get_key()");var u=this.setKey,g=this;return this.setKey=function(t){g.registers[e]=t,g.setKey=u.bind(g),g.setKey.apply(g,[t]),g.start()},void this.stop();case 21:console.log(this.counter,"setting delay timer to vx",this.delayTimer,this.registers[e]),this.delayTimer=this.registers[e];break;case 24:console.log(this.counter,"setting sound timer to vx",this.soundTimer,this.registers[e]),this.soundTimer=this.registers[e];break;case 30:console.log(this.counter,"adding vx to pointer"),this.pointer+=this.registers[e];break;case 41:console.log(this.counter,"Setting I to sprite location for char in vx",this.pointer,5*this.registers[e]),this.pointer=5*this.registers[e];break;case 51:var f=[this.registers[e]/100,this.registers[e]/10%10,this.registers[e]%10];console.log(this.counter,"set_BCD",e,this.registers[e],f),this.memory[this.pointer]=f[0],this.memory[this.pointer+1]=f[1],this.memory[this.pointer+2]=f[2];break;case 85:console.log(this.counter,"reg_dump");for(var k=0;k<=e;k++)this.memory[this.pointer+k]=this.registers[k];break;case 101:console.log(this.counter,"reg_load");for(var d=0;d<=e;d++)this.registers[d]=this.memory[this.pointer+d];this.pointer=this.pointer+e+1}break;default:throw new Error("Unknown opcode: ".concat(t.toString(16)))}n||(this.counter+=2)}},{key:"display",get:function(){return this.screen}},{key:"setKey",value:function(t){this.keys[t]=!0}},{key:"setPixel",value:function(t,e){var s=this.gfx.resolution.x,i=this.gfx.resolution.y;t>s?t-=s:t<0&&(t+=s),e>i?e-=i:e<0&&(e+=i);var r=t+e*s;return this.display[r]^=1,!this.screen[r]}}]),t}(),v=function(){function t(e){Object(b.a)(this,t),this.colors={background:"#000",foreground:"#00ff00"},this.canvas=null,this.context=null,this.resolution={x:64,y:32,scale:8},this.canvas=e.current,this.boot()}return Object(p.a)(t,[{key:"boot",value:function(){this.context=this.canvas.getContext("2d"),this.canvas.width=this.resolution.x*this.resolution.scale,this.canvas.height=this.resolution.y*this.resolution.scale,this.disp_clear()}},{key:"disp_clear",value:function(){var t;(null===(t=this.context)||void 0===t?void 0:t.clearRect)&&this.context.clearRect(0,0,this.resolution.x*this.resolution.scale,this.resolution.y*this.resolution.scale)}},{key:"paint",value:function(t){var e=this;if(this.disp_clear(),this.context){var s=this.context,i=this.resolution;t.map((function(t,r){var n=r%i.x*i.scale,o=Math.floor(r/i.x)*i.scale;return s.fillStyle=[e.colors.background,e.colors.foreground][t],s.fillRect(n,o,e.resolution.scale,e.resolution.scale),t}))}}}]),t}(),x=function(){function t(e,s,i){Object(b.a)(this,t),this.fps=60,this.frame=0,this.cpu=void 0,this.gfx=void 0;var r=new v(s),n=new y(e,r);i&&(this.fps=i),this.cpu=n,this.gfx=r,this.start(n,r)}return Object(p.a)(t,[{key:"start",value:function(t,e){var s=this,i=performance.now(),r=1e3/this.fps;this.frame=requestAnimationFrame((function n(o){s.frame=requestAnimationFrame(n);var c=o-i;if(c>=r-.1){i=o-c%r,t.next();var h=t.display;e.paint(h)}}))}},{key:"stop",value:function(){cancelAnimationFrame(this.frame)}}]),t}(),j=(s(57),s(2));var w=function(){var t=Object(i.useState)(!1),e=Object(u.a)(t,2),s=e[0],r=e[1],n=Object(i.useRef)(null),o={fps:60},h=o.fps,f=Object(i.useState)(o),b=Object(u.a)(f,2),p=b[0],m=b[1];return Object(i.useEffect)((function(){function t(){return(t=Object(l.a)(a.a.mark((function t(){var e,s,i,o,c;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r(!0),t.next=3,k()({url:"".concat("/chip.ts","/roms/pong"),method:"GET",responseType:"blob"});case 3:return e=t.sent,s=new Blob([e.data]),t.next=7,s.arrayBuffer();case 7:i=t.sent,o=new Uint8Array(i),c=new x(o,n,h),window.chip=c;case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}s||Object(d.a)()&&n&&(null===n||void 0===n?void 0:n.current)&&function(){t.apply(this,arguments)}()}),[s,n,h]),Object(j.jsxs)("div",{className:"container app",children:[Object(j.jsx)("div",{className:"row",children:Object(j.jsxs)("div",{className:"col-12 text-center",children:[Object(j.jsx)("h1",{children:"CHIP.ts"}),Object(j.jsx)("canvas",{"data-testid":"canvas",ref:n})]})}),Object(j.jsx)(g.c,{initialValues:Object(c.a)({},p),onSubmit:function(t){return m(t)},children:Object(j.jsxs)(g.b,{className:"row g-3 justify-content-lg-center",children:[Object(j.jsxs)("div",{className:"col-2 text-center form-floating",children:[Object(j.jsx)(g.a,{className:"form-control",type:"number",name:"fps",id:"fps",min:"0"}),Object(j.jsx)("label",{htmlFor:"fps",className:"text-dark",children:"Frame rate"})]}),Object(j.jsx)("div",{className:"col-2 text-center",children:Object(j.jsx)("button",{className:"btn btn-primary",type:"submit",children:"Submit"})})]})})]})},V=function(t){t&&t instanceof Function&&s.e(3).then(s.bind(null,61)).then((function(e){var s=e.getCLS,i=e.getFID,r=e.getFCP,n=e.getLCP,o=e.getTTFB;s(t),i(t),r(t),n(t),o(t)}))};s(59);o.a.render(Object(j.jsx)(r.a.StrictMode,{children:Object(j.jsx)(w,{})}),document.getElementById("root")),V()}},[[60,1,2]]]);
//# sourceMappingURL=main.6671149e.chunk.js.map